<!DOCTYPE html>
<html>

<head>
    <title>Äá»c mÃ£ QR tá»« mÃ¡y áº£nh</title>
</head>

<body>
    <h1>Äá»c mÃ£ QR tá»« camera sau vÃ  kiá»ƒm tra tá»“n táº¡i trong dá»¯ liá»‡u</h1>

    <video id="qr-video" width="300" height="300" autoplay></video>
    <canvas id="qr-canvas" style="display: none;"></canvas>

    <div>
        <p>Nháº­p sá»‘ Ä‘iá»‡n thoáº¡i Ä‘á»ƒ kiá»ƒm tra:</p>
        <input type="text" id="phoneNumberInput" placeholder="Nháº­p sá»‘ Ä‘iá»‡n thoáº¡i vÃ  nháº¥n Enter">
    </div>

    <script src="https://rawgit.com/cozmo/jsQR/master/dist/jsQR.js"></script>
    <script>
        const data = `
    030097014557	04/02/2023
    0986136962	04/02/2023
    `.trim();

        const lines = data.split('\n');
        const dataArray = [];

        lines.forEach(line => {
            const [phone, datetime] = line.split('\t');
            dataArray.push({ phone, datetime });
        });

        const video = document.getElementById('qr-video');
        const canvas = document.getElementById('qr-canvas');
        const context = canvas.getContext('2d');

        navigator.mediaDevices.enumerateDevices()
            .then(function (devices) {
                const frontCamera = devices.find(device => device.kind === 'videoinput' && device.label.includes('front'));
                if (frontCamera) {
                    return navigator.mediaDevices.getUserMedia({ video: { deviceId: frontCamera.deviceId } });
                }
                // Náº¿u khÃ´ng tÃ¬m tháº¥y camera trÆ°á»›c, sá»­ dá»¥ng camera máº·c Ä‘á»‹nh
                return navigator.mediaDevices.getUserMedia({ video: true });
            })
            .then(function (stream) {
                video.srcObject = stream;
            })
            .catch(function (error) {
                console.error('Lá»—i khi truy cáº­p mÃ¡y áº£nh:', error);
            });

        video.addEventListener('play', function () {
            canvas.width = video.videoWidth;
            canvas.height = video.videoHeight;

            (function loop() {
                if (!video.paused && !video.ended) {
                    context.drawImage(video, 0, 0, canvas.width, canvas.height);
                    const imageData = context.getImageData(0, 0, canvas.width, canvas.height);
                    const code = jsQR(imageData.data, imageData.width, imageData.height);

                    if (code) {
                        const phoneNumber = code.data.trim().substring(0, 12);
                        console.log('MÃ£ QR Ä‘Æ°á»£c tÃ¬m tháº¥y:', phoneNumber);
                        checkPhoneNumber(phoneNumber);
                    }
                }
                requestAnimationFrame(loop);
            })();
        });

        const phoneNumberInput = document.getElementById("phoneNumberInput");

        phoneNumberInput.addEventListener("keydown", (event) => {
            if (event.key === "Enter") {
                checkPhoneNumber(phoneNumberInput.value);
            }
        });

        function checkPhoneNumber(phoneNumber) {
            const foundEntry = dataArray.find(entry => entry.phone === phoneNumber);

            if (foundEntry) {
                alert(`âŒ ÄÃ£ SU NgÃ y: ${foundEntry.datetime} ... ğŸ˜­`);
            } else {
                alert("ğŸ˜ ChÆ°a SU!! ğŸ˜");
            }
        }
    </script>
</body>

</html>
